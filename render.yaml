## NOTE: Some Render accounts or YAML schema versions reject the `databases` block.
## To avoid schema mismatch, create a Postgres database in the Render dashboard
## (or via the UI) and then set the following environment variables on the
## `tolgee-backend` service to point to that database. If you prefer the
## database to be created from YAML, re-add a `databases:` block with the
## exact `type:` your Render account expects (examples: 'postgres' or
## 'postgresql'), but this repository uses manual DB setup to remain
## compatible with different Render schemas.

services:
  - type: web
    name: tolgee-backend
    # Use Docker runtime so Render will build the image from the Dockerfile
    runtime: docker
    dockerfilePath: Dockerfile
    envVars:
      # Database configuration â€” set these in the Render dashboard after
      # creating a Postgres database. Example values are shown as placeholders.
      - key: SPRING_DATASOURCE_URL
        value: "jdbc:postgresql://<DB_HOST>:<DB_PORT>/<DB_NAME>"
      - key: SPRING_DATASOURCE_USERNAME
        value: "<DB_USER>"
      - key: SPRING_DATASOURCE_PASSWORD
        sync: false
        # Do NOT store the password value in this file. Set the secret value
        # in the Render dashboard for the `tolgee-backend` service instead.
      # Disable application-side Docker/Postgres autostart (Tolgee setting)
      - key: tolgee.postgres-autostart.enabled
        value: "false"
      - key: SPRING_PROFILES_ACTIVE
        value: prod
      - key: TOLGEE_JWT_SECRET
        sync: false
      # Set frontend URL (replace with your frontend URL or set in Render dashboard)
      - key: TOLGEE_FRONTEND_URL
        value: "https://tolgee-frontend-sfnx.onrender.com/"
      # Memory and JVM optimization
      - key: JAVA_OPTS
        value: "-Xmx450m -Xms450m -XX:MaxMetaspaceSize=120m -XX:+UseG1GC -XX:+UseStringDeduplication -XX:+UseCompressedOops"
      # Hibernate/JPA optimization
      - key: SPRING_JPA_PROPERTIES_HIBERNATE_GENERATE_STATISTICS
        value: "false"
      - key: SPRING_JPA_PROPERTIES_HIBERNATE_JDBC_BATCH_SIZE
        value: "25"
      - key: SPRING_DATA_JPA_REPOSITORIES_BOOTSTRAP_MODE
        value: "deferred"
      # Port configuration
      - key: PORT
        value: "8080"
      - key: SERVER_PORT
        value: "8080"
    autoDeploy: true
    plan: free

  - type: web
    name: tolgee-frontend
    runtime: static
    # Build in webapp subfolder where the frontend package.json is located
    buildCommand: |
      cd webapp && \
      npm ci && \
      npm run build
    staticPublishPath: webapp/dist
    autoDeploy: true
